wsEditorData.wsMenuEditorPro=!!wsEditorData.wsMenuEditorPro;var wsIdCounter=0;window.wsAmeLodash=function(){"use strict";return"undefined"!=typeof wsAmeLodash?wsAmeLodash:_.noConflict()}(),jQuery.each(["grant_access","hidden_from_actor"],function(e,t){"use strict";wsEditorData.blankMenuItem.hasOwnProperty(t)&&!jQuery.isPlainObject(wsEditorData.blankMenuItem[t])&&(wsEditorData.blankMenuItem[t]={})}),AmeCapabilityManager=AmeActors;var AmePageTitles=function(e){"use strict";var t={},a={};function i(e,t){return t+"_"+e}return t.add=function(e,t,n){a[i(e,t)]=n},t.get=function(t,n,s){var o=i(t,n);void 0===a[o]?e.getJSON(wsEditorData.adminAjaxUrl,{action:"ws_ame_get_page_details",_ajax_nonce:wsEditorData.getPageDetailsNonce,post_id:t,blog_id:n},function(e){var i;i=void 0!==e.error?e.error:"object"!=typeof e||void 0===e.post_title?"< Server error >":e.post_title,a[o]=i,s(a[o],t,n)}):s(a[o],t,n)},t}(jQuery),AmeEditorApi={};window.AmeEditorApi=AmeEditorApi,function(e,t){"use strict";var a=new AmeActorSelector(AmeActors,wsEditorData.wsMenuEditorPro),i={templates:wsEditorData.itemTemplates,getTemplateById:function(e){return wsEditorData.itemTemplates.hasOwnProperty(e)?wsEditorData.itemTemplates[e]:""===e||"custom"===e?wsEditorData.customItemTemplate:null},getDefaults:function(e){var t=this.getTemplateById(e);return t?t.defaults:null},getDefaultValue:function(e,t){if("template_id"===t)return null;var a=this.getDefaults(e);return a&&void 0!==a[t]?a[t]:null},hasDefaultValue:function(e,t){return null!==this.getDefaultValue(e,t)}};function n(e){return"checkbox"===e.attr("type")?e.is(":checked"):e.val()}function s(e,t){e=void 0===e?"custom_item_":e,t=void 0===t?5:t;for(var a="",i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n=0;n<t;n++)a+=i.charAt(Math.floor(Math.random()*i.length));return e+a}function o(a){a.hasOwnProperty("color_presets")&&!e.isPlainObject(a.color_presets)&&(a.color_presets={});var i=["grant_access","hidden_from_actor"];e.each(a.tree,function t(a,n){for(var s=0;s<i.length;s++){var o=i[s];n.hasOwnProperty(o)&&!e.isPlainObject(n[o])&&(n[o]={})}n.hasOwnProperty("items")&&e.each(n.items,t)}),N="object"==typeof a.color_presets?e.extend(!0,{},a.color_presets):{},U=!1,AmeCapabilityManager.setGrantedCapabilities(t.get(a,"granted_capabilities",{})),V=t.get(a,"component_visibility",{}),AmeEditorApi.refreshComponentVisibility(),function(t){var a=e.extend(!0,{},t),i=e("#ws_menu_box");for(var n in i.empty(),e("#ws_submenu_box").empty(),a)a.hasOwnProperty(n)&&r(a[n]);i.find(".ws_menu:first").click()}(a.tree)}function r(t,a){var i=l(t,!0);null!=a?e(a).after(i):i.appendTo("#ws_menu_box");var n=function(t,a){var i=e('<div class="ws_submenu" style="display:none;"></div>');i.attr("id","ws-submenu-"+wsIdCounter++),a&&i.data("parent_menu_id",a);var n=null;t&&e.each(t,function(e,t){(n=l(t,!1))&&(i.append(n),g(n))});return x(i),i}(t.items,i.attr("id"));return n.appendTo("#ws_submenu_box"),i.data("submenu_id",n.attr("id")),g(i),{menu:i,submenu:n}}function l(t,a){a=void 0!==a&&a;var i=e("<div></div>").attr("class","ws_container").attr("id","ws-menu-item-"+wsIdCounter++).data("menu_item",t).data("field_editors_created",!1);i.addClass(a?"ws_menu":"ws_item"),t.separator&&i.addClass("ws_menu_separator");var n=[],s=b(t,"menu_title","");""===s&&(s="&nbsp;"),n.push('<div class="ws_item_head">',t.separator?"":'<a class="ws_edit_link"> </a><div class="ws_flag_container"> </div>','<input type="checkbox" class="ws_actor_access_checkbox">','<span class="ws_item_title">',u(s),"&nbsp;</span>","</div>",'<div class="ws_editbox" style="display: none;"></div>'),i.append(n.join(""));for(var o=["hidden","unused","custom"],r=0;r<o.length;r++)C(i,o[r],b(t,o[r],!1));return a&&!t.separator&&i.droppable({hoverClass:"ws_menu_drop_hover",accept:function(e){return e.hasClass("ws_item")},drop:function(t,a){var n=l(D(a.draggable),!1),s=a.draggable.parent(),o=e("#"+i.data("submenu_id"));o.append(n),t.ctrlKey||a.draggable.remove(),g(n),v(o),v(s)}}),i}function d(e){return e.replace(/^\s+|\s+$/g,"")}function c(e){return e.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"").replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,"")}function u(e){var t,a,i;return e=d(e=(e=c(e)).replace(/[\s\t\r\n]+/g," ")),a=34,void 0===(i="â€¦")&&(i=""),(t=e).length>a&&(t=t.substring(0,a-1)+i),e=t}AmeEditorApi.jsTrim=d;var _={caption:"[No caption]",standardCaption:!0,advanced:!1,type:"text",defaultValue:"",onlyForTopMenus:!1,addDropdown:!1,visible:!0,write:null,display:null,tooltip:null},p={menu_title:e.extend({},_,{caption:"Menu title",display:function(e,t,a,i){return i.find(".ws_item_title").html(u(t)+"&nbsp;"),t},write:function(e,t,a,i){e.menu_title=t,i.find(".ws_item_title").html(c(a.val())+"&nbsp;")}}),template_id:e.extend({},_,{caption:"Target page",type:"select",options:function(){var e=[];for(var t in e.push([wsEditorData.customItemTemplate.name,""]),wsEditorData.itemTemplates)wsEditorData.itemTemplates.hasOwnProperty(t)&&e.push([wsEditorData.itemTemplates[t].name,t]);return e.sort(function(e,t){if(e[1]===t[1])return 0;if(""===e[1])return-1;if(""===t[1])return 1;var a=">"===e[1].charAt(0)?1:0,i=">"===t[1].charAt(0)?1:0;return a!==i?i-a:e[0]>t[0]?1:e[0]<t[0]?-1:0}),e}(),write:function(t,a,n,s){var o=t.template_id;t.template_id=a,t.defaults=i.getDefaults(t.template_id),t.custom=""===t.template_id,""!==t.template_id&&(t.file=null),s.find(".ws_edit_field").each(function(a,n){var s=(n=e(n)).data("field_name"),r=null===t[s],l=i.hasDefaultValue(t.template_id,s);if(r&&!l){var d=i.getDefaultValue(o,s);null!==d&&(t[s]=d)}})}}),embedded_page_id:e.extend({},_,{caption:"Embedded page ID",defaultValue:"Select page to display",type:"text",visible:!1,addDropdown:"ws_embedded_page_selector",display:function(e,t,a){a.closest(".ws_edit_field").toggle(e.template_id===wsEditorData.embeddedPageTemplateId),a.prop("readonly",!0);var i=parseInt(b(e,"embedded_page_id",0),10),n=parseInt(b(e,"embedded_page_blog_id",1),10),s="ID: "+i;return i<=0?"Select page =>":(1!==n&&(s=s+", blog ID: "+n),t=s,AmePageTitles.get(i,n,function(o){var r=parseInt(b(e,"embedded_page_id",0),10),l=parseInt(b(e,"embedded_page_blog_id",1),10);r===i&&l===n&&(t=o+" ("+s+")",a.val(t))}),t)},write:function(){}}),file:e.extend({},_,{caption:"URL",display:function(e,t,a){return""!==e.template_id?(a.attr("readonly","readonly"),t=i.getDefaultValue(e.template_id,"url")):a.removeAttr("readonly"),t},write:function(e,t){""===t&&(t=e.file),""!==e.template_id&&(t=null),e.file=t}}),access_level:e.extend({},_,{caption:"Permissions",defaultValue:"read",type:"access_editor",visible:!1,display:function(e){var t=b(e,"access_level",""),a=b(e,"extra_capability",""),i=""===e.template_id?"< Custom >":t;return""!==a&&(i=""===e.template_id?a:i+"+"+a),i},write:function(e){e.access_level=null}}),required_capability_read_only:e.extend({},_,{caption:"Required capability",defaultValue:"none",type:"text",tooltip:"Only users who have this capability can see the menu. The capability can't be changed because it's usually hard-coded in WordPress or the plugin that created the menu.<br><br>Use the \"Extra capability\" field to restrict access to this menu.",visible:function(e){return!wsEditorData.wsMenuEditorPro&&""!==e.template_id},display:function(e,t,a){return a.prop("readonly",!0),b(e,"access_level","")},write:function(e,t){}}),extra_capability:e.extend({},_,{caption:"Extra capability",defaultValue:"read",type:"text",addDropdown:"ws_cap_selector",tooltip:function(e){return""===e.template_id?"Only users who have this capability can see the menu.":"An additional capability check that is applied on top of the required capability."},display:function(e){var t=b(e,"access_level",""),a=b(e,"extra_capability",""),i=a;return""===e.template_id&&""===a&&(i=t),i},write:function(e,t){""!==(t=d(t))?e.extra_capability=t:e.extra_capability=null}}),appearance_heading:e.extend({},_,{caption:"Appearance",advanced:!0,onlyForTopMenus:!1,type:"heading",standardCaption:!1,visible:!1}),icon_url:e.extend({},_,{caption:"Icon URL",type:"icon_selector",advanced:!0,defaultValue:"div",onlyForTopMenus:!0,display:function(e,t,a,i){var n=b(e,"css_class",""),s=b(e,"icon_url","",i);t=s,(void 0===e.icon_url||null===e.icon_url)&&"if_custom"===wsEditorData.submenuIconsEnabled&&i.hasClass("ws_item")&&(s="none",n="");var o=a.closest(".ws_edit_field").find(".ws_select_icon"),r=o.find(".icon16"),l=o.find("img"),d=n.match(/\b(ame-)?menu-icon-([^\s]+)\b/),c=s&&s.match(/^\s*((dashicons|ame-fa)-[a-z0-9\-]+)/);if(s&&"none"!==s&&"div"!==s&&!c)r.hide(),l.prop("src",s).show();else if(c)r.removeClass().addClass("icon16"),"dashicons"===c[2]?r.addClass("dashicons "+c[1]):"ame-fa"===c[2]&&r.addClass("ame-fa "+c[1]),l.hide(),r.show();else if(d){l.hide();var u=(d[1]?d[1]:"")+"icon-"+d[2];r.removeClass().addClass("icon16 "+u).show()}else l.hide(),r.removeClass().addClass("icon16").show();return t}}),colors:e.extend({},_,{caption:"Color scheme",defaultValue:"Default",type:"color_scheme_editor",onlyForTopMenus:!0,visible:!1,advanced:!0,display:function(t,a,i,n){var s=b(t,"colors",{})||{},o=n.find(".ws_color_scheme_display");o.empty();var r=0;return e.each(s,function(t,a){!a||r>=7||(o.append(e("<span></span>").addClass("ws_color_display_item").css("background-color",a)),r++)}),0===r&&o.append("Default"),"Placeholder. You should never see this."},write:function(e){}}),html_heading:e.extend({},_,{caption:"HTML",advanced:!0,onlyForTopMenus:!0,type:"heading",standardCaption:!1}),open_in:e.extend({},_,{caption:"Open in",advanced:!0,type:"select",options:[["Same window or tab","same_window"],["New window","new_window"],["Frame","iframe"]],defaultValue:"same_window",visible:!1}),iframe_height:e.extend({},_,{caption:"Frame height (pixels)",advanced:!0,visible:function(e){return wsEditorData.wsMenuEditorPro&&"iframe"===b(e,"open_in")},display:function(e,t,a){return a.prop("placeholder","Auto"),0!==t&&"0"!==t||(t=""),t},write:function(e,t){t=parseInt(t,10),(isNaN(t)||t<0)&&(t=0),(t=Math.round(t))>1e4&&(t=1e4),e.iframe_height=0===t?null:t}}),css_class:e.extend({},_,{caption:"CSS classes",advanced:!0,onlyForTopMenus:!0}),hookname:e.extend({},_,{caption:"ID attribute",advanced:!0,onlyForTopMenus:!0}),page_properties_heading:e.extend({},_,{caption:"Page",advanced:!0,onlyForTopMenus:!0,type:"heading",standardCaption:!1}),page_heading:e.extend({},_,{caption:"Page heading",advanced:!0,onlyForTopMenus:!1,visible:!1}),page_title:e.extend({},_,{caption:"Window title",standardCaption:!0,advanced:!0}),is_always_open:e.extend({},_,{caption:"Keep this menu expanded",advanced:!0,onlyForTopMenus:!0,type:"checkbox",standardCaption:!1})};function m(t,a,i){var n=null;switch(i.type){case"select":n=e('<select class="ws_field_value">');for(var s=0;s<i.options.length;s++){var o=i.options[s][0],r=i.options[s][1];e("<option>").val(r).text(o).appendTo(n)}break;case"checkbox":n=e('<label><input type="checkbox" class="ws_field_value"> <span class="ws_field_label_text">'+i.caption+"</span></label>");break;case"access_editor":n=e('<input type="text" class="ws_field_value" readonly="readonly">').add('<input type="button" class="button ws_launch_access_editor" value="Edit...">');break;case"icon_selector":n=e('<input type="text" class="ws_field_value">').add('<button class="button ws_select_icon" title="Select icon"><div class="icon16 icon-settings"></div><img src="" style="display:none;" alt="Icon"></button>');break;case"color_scheme_editor":n=e('<span class="ws_color_scheme_display">Placeholder</span>').add('<input type="button" class="button ws_open_color_editor" value="Edit...">');break;case"heading":n=e("<span>"+i.caption+"</span>");break;case"text":default:n=e('<input type="text" class="ws_field_value">')}var l="ws_edit_field ws_edit_field-"+a;i.addDropdown&&(l+=" ws_has_dropdown"),i.standardCaption||(l+=" ws_no_field_caption"),"heading"===i.type&&(l+=" ws_field_group_heading");var d="";if(i.standardCaption){var c="";null!==i.tooltip&&(c=' <a class="ws_field_tooltip_trigger"><div class="dashicons dashicons-info"></div></a>'),d='<span class="ws_field_label_text">'+i.caption+c+"</span><br>"}var u=e("<div>"+d+"</div>").attr("class",l).append(n);if(i.addDropdown){var _=i.addDropdown;u.append(e('<input type="button" value="&#9660;">').addClass("button ws_dropdown_button "+_+"_trigger").attr("tabindex","-1").data("dropdownId",_))}u.append(e('<img class="ws_reset_button" title="Reset to default value" src="" alt="Reset">').attr("src",wsEditorData.imagesUrl+"/transparent16.png")).data("field_name",a);return("function"==typeof i.visible?i.visible(t,a):i.visible)||u.css("display","none"),u}function f(t){var a=t.closest(".ws_submenu","#ws_menu_editor").data("parent_menu_id");return e(a?"#"+a:[])}function w(t){var a=t.data("submenu_id");return a?e("#"+a).find(".ws_container"):e([])}function h(i){var n=i.data("menu_item");if(null!==a.selectedActor){var s,o,r=P(n,a.selectedActor),l=function(e,t){if(e.grant_access&&e.grant_access.hasOwnProperty&&e.grant_access.hasOwnProperty(t))return null!==e.grant_access[t];return!1}(n,a.selectedActor),d=!r&&b(n,"restrict_access_to_items",!1),c=i;do{if((o=(s=f(c)).data("menu_item"))&&b(o,"restrict_access_to_items",!1)&&!P(o,a.selectedActor)){r=!1,d=!0;break}c=s}while(s.length>0);var u=i.find(".ws_actor_access_checkbox");u.prop("checked",r);var _=null===r,p=w(i);if(p.length>0&&!d){var m=!1;p.each(function(){var t=e(this).data("menu_item");return!t||(P(t,a.selectedActor)===r||(m=!0,!1))}),m&&(_=!0)}u.prop("indeterminate",_),_&&null===r?C(i,"uncertain_meta_cap",!0,'This item might be visible.\nThe plugin cannot reliably detect if "'+a.selectedDisplayName+'" has the "'+b(n,"access_level","[No capability]")+'" capability. If you need to hide the item, try checking and then unchecking it.'):C(i,"uncertain_meta_cap",!1),i.toggleClass("ws_is_hidden_for_actor",!r),i.toggleClass("ws_has_custom_permissions_for_actor",l),C(i,"custom_actor_permissions",l),C(i,"hidden_from_others",!1)}else{i.removeClass("ws_is_hidden_for_actor ws_has_custom_permissions_for_actor"),C(i,"custom_actor_permissions",!1),C(i,"uncertain_meta_cap",!1);var h="user:"+wsEditorData.currentUserLogin,v=t(wsEditorData.actors).keys().without(h,"special:super_admin").value(),g=!P(n,h),y=t.curry(P,2)(n),x=t.every(v,function(e){return!1===y(e)}),A=AmeActors.isMultisite&&P(n,"special:super_admin");C(i,"hidden_from_others",x,g?"Hidden from everyone":"Hidden from everyone except you"+(A?" and Super Admins":""))}C(i,"hidden",I(n,a.selectedActor))}function v(t){var a=(t.is(".ws_submenu")?t:t.parent()).data("parent_menu_id");a&&h(e("#"+a))}function g(t){for(var a=t.data("menu_item"),n=["hidden","unused","custom"],s=0;s<n.length;s++)C(t,n[s],b(a,n[s],!1));h(t),t.find(".ws_edit_field").each(function(n,s){var o=(s=e(s)).data("field_name"),r=s.find(".ws_field_value").first(),l=i.hasDefaultValue(a.template_id,o),d=y(a,o,null,t),c=l&&(void 0===a[o]||null===a[o]);"access_level"===o?c=""===b(a,"extra_capability","")&&function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}(a.grant_access)&&!b(a,"restrict_access_to_items",!1):"required_capability_read_only"===o&&(c=!0,l=!0),s.toggleClass("ws_has_no_default",!l),s.toggleClass("ws_input_default",c);var u=c?d:a[o];(null!==p[o].display&&(u=p[o].display(a,u,r,t)),function(e,t){"checkbox"===e.attr("type")?e.prop("checked",t):e.val(t)}(r,u),r.length>0&&e.data(r.get(0),"ame_last_display_value",u),"function"==typeof p[o].visible)&&(p[o].visible(a,o)?s.css("display",""):s.css("display","none"))})}function b(e,t,a,i){return void 0===e[t]||null===e[t]?y(e,t,a,i):e[t]}function y(e,t,a,n){if("icon_url"===t&&n&&"never"!==wsEditorData.submenuIconsEnabled){var s=f(n),o=s.data("menu_item");if(o)return b(o,t,a,s)}if("page_title"===t&&""!==e.template_id){var r=i.getDefaultValue(e.template_id,"page_title"),l=i.getDefaultValue(e.template_id,"menu_title"),d=e.menu_title;if(null!==d&&""!==d&&(""===r||l===r))return d}if(void 0===a&&(a=null),""===e.template_id||void 0!==i.templates[e.template_id]){var c=i.getDefaultValue(e.template_id,t);return null!==c?c:a}return"template_id"===t?null:void 0!==e.defaults&&void 0!==e.defaults[t]?e.defaults[t]:a}function x(e){e.sortable({items:"> .ws_container",cursor:"move",dropOnEmpty:!0,cancel:".ws_editbox, .ws_edit_link",placeholder:"ws_container ws_sortable_placeholder",forcePlaceholderSize:!0,stop:function(e,t){t.item.css("z-index",""),t.item.hasClass("ws_menu")&&t.item.hasClass("ws_active")&&AmeEditorApi.updateSubmenuBoxHeight(t.item)}})}function A(a){return void 0!==a&&a||(a=E()),a.format={name:wsEditorData.menuFormatName,version:wsEditorData.menuFormatVersion},a=function(e){var a={properties:t.omit(wsEditorData.blankMenuItem,["defaults"]),basic_defaults:t.clone(t.get(wsEditorData.blankMenuItem,"defaults",{})),custom_item_defaults:t.clone(i.getTemplateById("").defaults)};function n(e){t.isEmpty(e.grant_access)&&delete e.grant_access,t.isEmpty(e.items)&&delete e.items;var i=t.get(e,"custom",!1)?a.custom_item_defaults:a.basic_defaults;return t.has(e,"defaults")&&t.forEach(i,function(a,i){t.has(e.defaults,i)&&e.defaults[i]===a&&delete e.defaults[i]}),t.forEach(a.properties,function(a,i){t.has(e,i)&&e[i]===a&&delete e[i]}),e}return e.format.compressed=!0,e.format.common=a,e.tree=t.mapValues(e.tree,function(e){return void 0!==(e=n(e)).items&&(e.items=t.map(e.items,n)),e}),e}(a),e.toJSON(a)}function E(){var t={},a=0,i={};return e("#ws_menu_box").find(".ws_menu").each(function(){var e=D(this,a++),n=b(e,"file");if(e.template_id===wsEditorData.unclickableTemplateId?(j++,n="#"+wsEditorData.unclickableTemplateClass+"-"+j):e.template_id===wsEditorData.embeddedPageTemplateId&&(n="#embedded-page-"+ ++j),i.hasOwnProperty(n))throw{code:"duplicate_top_level_url",message:"Error: Found a duplicate URL! All top level menus must have unique URLs.",duplicates:[i[n],this]};t[n]=e,i[n]=this}),AmeCapabilityManager.pruneGrantedUserCapabilities(),{tree:t,color_presets:e.extend(!0,{},N),granted_capabilities:AmeCapabilityManager.getGrantedCapabilities(),component_visibility:e.extend(!0,{},V)}}function D(t,a){a=void 0===a?0:a,t=e(t);var i=e.extend(!0,{},wsEditorData.blankMenuItem,t.data("menu_item"),function(t){t.hasClass("ws_container")||(t=t.closest(".ws_container"));if(!t.data("field_editors_created"))return t.data("menu_item");var a={};return t.find(".ws_edit_field").each(function(){var t=e(this),i=t.data("field_name");if(!i)return!0;if("embedded_page_id"===i)return!0;if(t.hasClass("ws_field_group_heading"))return!0;var s=t.find(".ws_field_value");return t.hasClass("ws_input_default")?a[i]=null:a[i]=n(s),!0}),a.access_level=null,a}(t));i.defaults=t.data("menu_item").defaults,i.position=a,i.defaults.position=a,i.separator=t.hasClass("ws_menu_separator"),i.custom=function(t,a){return e(t).hasClass("ws_"+a)}(t,"custom"),i.items=[];var s=t.data("submenu_id");if(s){var o=0;e("#"+s).find(".ws_item").each(function(){var e=D(this,o++);i.items.push(e)})}return i}AmeEditorApi.getItemDisplayUrl=function(e){var t=b(e,"file","");if(""!==e.template_id){var a=i.getDefaultValue(e.template_id,"url");a&&(t=a)}return t},AmeEditorApi.getFieldValue=b,AmeEditorApi.forEachMenuItem=function(t,a){void 0===a&&(a=!0),e("#ws_menu_editor").find(".ws_container").each(function(){var i=e(this);if(!a||!i.hasClass("ws_menu_separator"))return t(i.data("menu_item"),i)})},AmeEditorApi.selectMenuItemByUrl=function(t,a,i){void 0===i&&(i=null);var n=e(t);n.is("#ws_submenu_box")&&(n=n.find(".ws_submenu:visible").first());var s=n.find(".ws_container").filter(function(){return AmeEditorApi.getItemDisplayUrl(e(this).data("menu_item"))===a}).first();if(s.length>0&&(AmeEditorApi.selectItem(s),null!==i)){var o=s.find(".ws_edit_link").first();o.hasClass("ws_edit_link_expanded")!==i&&o.click()}return s},AmeEditorApi.readMenuTreeState=E,AmeEditorApi.encodeMenuAsJson=A;var k={custom:"This is a custom menu item",unused:"This item was added since the last time you saved menu settings.",hidden:"Cosmetically hidden",custom_actor_permissions:"The selected role has custom permissions for this item.",hidden_from_others:"Hidden from everyone except you.",uncertain_meta_cap:"The plugin cannot detect if this item is visible by default."};function C(t,a,i,n){n=n||k[a];var s="ws_"+a,o="ws_"+a+"_flag";if((t=e(t)).toggleClass(s,i),i){var r=t.find(".ws_flag_container"),l=r.find("."+o);0===l.length&&(l=e("<div></div>").addClass("ws_flag").addClass(o),r.append(l)),l.attr("title",n)}else t.find("."+o).remove()}function I(e,t){var i,n,s=!1;if(null===t||e.hidden)return e.hidden;if("user:"===t.substr(0,"user:".length))if(e.hidden_from_actor.hasOwnProperty(t))s=e.hidden_from_actor[t];else{n=a.selectedActor.substr("user:".length),i=AmeCapabilityManager.getGroupActorsFor(n);for(var o=0;o<i.length;o++){if(!e.hidden_from_actor.hasOwnProperty(i[o])||!e.hidden_from_actor[i[o]]){s=!1;break}s=!0}}else s=e.hidden_from_actor.hasOwnProperty(t)&&e.hidden_from_actor[t];return s}function M(t,i){var n=t.data("menu_item");void 0===i&&(i=!I(n,a.selectedActor)),null===a.selectedActor?(n.hidden=i,n.hidden_from_actor={}):(i?n.hidden_from_actor[a.selectedActor]=!0:0===a.selectedActor.indexOf("user:")?n.hidden_from_actor[a.selectedActor]=!1:delete n.hidden_from_actor[a.selectedActor],!i&&n.hidden&&(n.hidden=!1,e.each(wsEditorData.actors,function(e){e!==a.selectedActor&&(n.hidden_from_actor[e]=!0)}))),C(t,"hidden",i);var s=t.data("submenu_id");s&&e("#"+s+" .ws_item").each(function(){M(e(this),i)})}function P(t,a){e.isPlainObject(t.grant_access)||(t.grant_access={});var i=b(t,"access_level","< Error: access_level is missing! >");return t.grant_access.hasOwnProperty(a)?t.grant_access[a]:AmeCapabilityManager.hasCap(a,i,t.grant_access)}function T(a,i,n){var s=a.data("menu_item");e.isPlainObject(s.grant_access)||(s.grant_access={}),"string"==typeof i?s.grant_access[i]=Boolean(n):t.assign(s.grant_access,i)}function S(t,a){return e.isPlainObject(t.grant_access)||(t.grant_access={}),e.each(wsEditorData.actors,function(e){(null===a||AmeActorManager.compareActorSpecificity(a,e)>=0)&&(t.grant_access[e]=!1)}),null!==a&&(t.grant_access[a]=!0),t}AmeEditorApi.actorCanAccessMenu=P;var O=null,j=0,N={},U=!1,V={},F=!1;function L(){F=!0,wsEditorData.wsMenuEditorPro&&(p.open_in.visible=!0,p.access_level.visible=!0,p.page_heading.visible=!0,p.colors.visible=!0,p.appearance_heading.visible=!0,p.appearance_heading.onlyForTopMenus=!1,p.extra_capability.visible=!1,p.icon_url.onlyForTopMenus="never"===wsEditorData.submenuIconsEnabled,e(".ws_hide_if_pro").hide()),e(document).trigger("filterMenuFields.adminMenuEditor",[p,_]);var c=e("#ws_menu_box");x(c);var f=e("#ws_menu_editor"),k=e("#ws_submenu_box"),C=k.closest(".ws_main_container").find(".ws_dropzone"),I=null;function L(t){t.hasClass("ws_active")||(t.addClass("ws_active"),t.siblings(".ws_active").removeClass("ws_active"),t.hasClass("ws_menu")&&(I&&I.hide(),I=e("#"+t.data("submenu_id")).show(),q(t),I.closest(".ws_main_container").find(".ws_toolbar .ws_delete_menu_button").toggleClass("ws_button_disabled",!Ce(Ne()))),t.closest(".ws_main_container").find(".ws_toolbar .ws_delete_menu_button").toggleClass("ws_button_disabled",!Ce(t)))}function q(e){if(e.hasClass("ws_menu_separator"))k.css("min-height","");else{var t=k.offset().top-c.offset().top,a=e.offset().top-c.offset().top-t+30-C.outerHeight()+4;a=Math.max(a,0),k.css("min-height",a)}}function H(t,a){var i=AmeItemAccessEditor.detectExtPermissions(AmeEditorApi.getItemDisplayUrl(a)),n=t.find(".ws_edit_field-access_level .ws_field_label_text"),s=n.find(".ws_ext_permissions_indicator");wsEditorData.wsMenuEditorPro&&null!==i?(s.length<1&&(s=e('<div class="dashicons dashicons-info ws_ext_permissions_indicator"></div>'),n.append(" ").append(s)),s.show().data("ext_permissions",i)):s.hide()}function z(t,a,i){T(t,a,i);var n=t.data("submenu_id");n&&t.hasClass("ws_menu")&&e(".ws_item","#"+n).each(function(){var t=e(this);T(t,a,i),g(t)}),g(t),v(t)}AmeEditorApi.selectItem=L,f.on("click",".ws_container",function(){L(e(this))}),AmeEditorApi.updateSubmenuBoxHeight=q,f.on("adminMenuEditor:fieldChange",function(t,a,i){"template_id"!==i&&"file"!==i||H(e(t.target),a)}),f.on("click",".ws_edit_link",function(t){t.preventDefault();var a=e(this).parents(".ws_container").first(),i=a.find(".ws_editbox");if(!a.data("field_editors_created")){var n=a.data("menu_item");!function(t,a,i){i=void 0!==i&&i;var n=e('<div class="ws_edit_panel ws_basic"></div>').appendTo(t),s=e('<div class="ws_edit_panel ws_advanced"></div>').appendTo(t);for(var o in wsEditorData.hideAdvancedSettings&&s.css("display","none"),p)if(p.hasOwnProperty(o)){var r=p[o];if(!r.onlyForTopMenus||i){var l=m(a,o,r);l&&(r.advanced?s.append(l):n.append(l))}}t.append('<div class="ws_toggle_container"><a href="#" class="ws_toggle_advanced_fields"'+(wsEditorData.hideAdvancedSettings?"":' style="display:none;" ')+">"+(wsEditorData.hideAdvancedSettings?wsEditorData.captionShowAdvanced:wsEditorData.captionHideAdvanced)+"</a></div>")}(i,n,a.hasClass("ws_menu")),a.data("field_editors_created",!0),g(a),H(a,n)}e(this).toggleClass("ws_edit_link_expanded"),e(this).hasClass("ws_edit_link_expanded")?i.show():(i.find("input").change(),i.hide())}),f.on("click",".ws_reset_button",function(){var t=e(this).parents(".ws_edit_field"),a=t.data("field_name");if(t.length>0&&a){var n=t.closest(".ws_container"),s=n.data("menu_item");"access_level"===a&&(s.grant_access={},s.extra_capability=null,s.restrict_access_to_items=!1,delete s.had_access_before_hiding),i.hasDefaultValue(s.template_id,a)&&(s[a]=null,g(n),v(n))}}),f.on("click change",".ws_field_value",function(){var t=e(this),a=t.parents(".ws_edit_field").first(),i=a.data("field_name");if("access_level"!==i&&"embedded_page_id"!==i){var s=a.parents(".ws_container").first(),o=s.data("menu_item"),r=o[i],l=e.data(this,"ame_last_display_value"),d=n(t),c=y(o,i,null,s),u=null!==c;a.toggleClass("ws_has_no_default",!u),u||a.removeClass("ws_input_default"),a.hasClass("ws_input_default")&&d==c&&(d=null),d!==r&&d!==l&&(null!==p[i].write?p[i].write(o,d,t,s):o[i]=d,g(s),v(s),s.trigger("adminMenuEditor:fieldChange",[o,i]))}}),f.on("click",".ws_toggle_advanced_fields",function(){var t=e(this),a=t.parents(".ws_container").first().find(".ws_advanced");return a.is(":visible")?(a.hide(),t.text(wsEditorData.captionShowAdvanced)):(a.show(),t.text(wsEditorData.captionHideAdvanced)),!1}),f.on("click","input.ws_actor_access_checkbox",function(){if(null!==a.selectedActor){var t=e(this).is(":checked"),i=e(this).closest(".ws_container"),n=i.data("menu_item");t||"index.php>index.php"!==n.template_id&&">index.php"!==n.template_id?z(i,a.selectedActor,t):(g(i),function(e){if(!wsEditorData.dashboardHidingConfirmationEnabled)return void e(!0);B=e,R.dialog("open")}(function(e){e&&z(i,a.selectedActor,t)}))}});var R=e("#ws-ame-dashboard-hide-confirmation").dialog({autoOpen:!1,modal:!0,closeText:" ",width:380,title:"Warning"}),B=function(e){};e("#ws_confirm_menu_hiding, #ws_cancel_menu_hiding").click(function(){var t=e(this).is("#ws_confirm_menu_hiding"),a=R.find('.ws_dont_show_again input[type="checkbox"]').is(":checked");B(t),R.dialog("close"),a&&(wsEditorData.dashboardHidingConfirmationEnabled=!1,e.post(wsEditorData.adminAjaxUrl,{action:"ws_ame_disable_dashboard_hiding_confirmation",_ajax_nonce:wsEditorData.disableDashboardConfirmationNonce}))}),AmeItemAccessEditor.setup({api:AmeEditorApi,actorSelector:a,postTypes:wsEditorData.postTypes,taxonomies:wsEditorData.taxonomies,lodash:t,isPro:wsEditorData.wsMenuEditorPro,save:function(e,a,i){e.extra_capability=i.extraCapability,e.grant_access=i.grantAccess,e.restrict_access_to_items=i.restrictAccessToItems;var n={};t.forEach(i.grantedCapabilities,function(e,a){t.forEach(e,function(e,i){t.isArray(e)||(e=[e,null,null]),AmeCapabilityManager.setCap(a,i,e[0],e[1],e[2]),e[0]||(n.hasOwnProperty(i)||(n[i]=[]),n[i].push(a))})}),AmeEditorApi.forEachMenuItem(function(e,a){var i=b(e,"access_level");n.hasOwnProperty(i)&&t.forEach(n[i],function(a){!0===t.get(e.grant_access,a)&&delete e.grant_access[a]}),h(a)}),g(a)}}),f.on("click",".ws_launch_access_editor",function(){var t=e(this).parents(".ws_container").first(),i=t.data("menu_item");AmeItemAccessEditor.open({menuItem:i,containerNode:t,selectedActor:a.selectedActor,itemHasSubmenus:!!t.data("submenu_id")&&e("#"+t.data("submenu_id")).find(".ws_item").length>0})}),e(document).on("click",".ws_close_dialog",function(){e(this).parents(".ui-dialog-content").dialog("close")});var G=e("#ws_cap_selector"),W=null,Q=null,K=!1,J=!1;function Y(t){var a=null,i=e(this),n=!1;if(J=!1,"ws_trigger_capability_dropdown"===i.attr("id")?(a=e("#ws_extra_capability"),n=!0):a=i.closest(".ws_edit_field").find(".ws_field_value").first(),"mousedown"!==t.type)if(K)K=!1;else{var s=e(this).closest(".ui-dialog, #ws_menu_editor");if(s.length>0&&0===G.closest(s).length){var o=G.height();G.detach().appendTo(s).height(o)}G.val(a.val()).show();var r=a.offset();G.css({position:"absolute",zIndex:1010}).offset({left:r.left,top:r.top+a.outerHeight()}).width(a.outerWidth()),W=a,Q=null,Q=n?AmeItemAccessEditor.getCurrentMenuItem():W.closest(".ws_container").data("menu_item"),G.focus(),Z.show()}else G.is(":visible")&&a.is(W)&&(K=!0)}function $(){G.hide(),Z.hide(),J=!1}e("#ws_trigger_capability_dropdown").on("mousedown click",Y),f.on("mousedown click",".ws_cap_selector_trigger",Y),e("#ws_extra_capability").bind("keyup",function(t){40===t.which&&e("#ws_trigger_capability_dropdown").click()});var X=e(".ws_dropdown");X.blur(function(){J||$()}),X.keydown(function(e){27===e.which?($(),W&&W.focus()):13!==e.which&&9!==e.which||($(),W&&(G.val()&&W.val(G.val()).change(),W.focus()),e.preventDefault())}),X.keyup(function(e){9===e.which&&e.preventDefault()}),X.click(function(){G.val()&&($(),W&&W.val(G.val()).change().focus())}),X.mousemove(function(e){if(e.target){var t=e.target;void 0!==t.selected&&!t.selected&&t.value&&(t.selected=!0,Z.previewAccessForItem(Q,t.value))}});var Z=function(){if(wsEditorData.wsMenuEditorPro)return{previewAccessForItem:function(){},show:function(){},hide:function(){}};for(var a=e("#ws_capability_suggestions"),i=a.find("table tbody").first().empty(),n=AmeActors.getSuggestedCapabilities(),s=0;s<n.length;s++){var o=n[s].role,r=n[s].capability;e("<tr>").data("role",o).data("capability",r).append(e("<th>",{text:o.displayName,scope:"row"}).addClass("ws_ame_role_name")).append(e("<td>",{text:r}).addClass("ws_ame_suggested_capability")).appendTo(i)}var l=null;function d(n,s){var o="",r="";n&&(o=b(n,"access_level",""),r=b(n,"extra_capability","")),void 0!==s&&(r=s);var d,c=[];(n&&""!==n.template_id||""===r)&&c.push(o),""!==r&&c.push(r),"string"==typeof(d=c)&&(d=[d]),t.isEqual(d,l)||(l=d,a.find("#ws_previewed_caps").text(l.join(" + ")),null!==d&&0!==d.length?i.find("tr").each(function(){for(var t=e(this),a=t.data("role"),i=!0,n=0;n<d.length;n++)i=i&&AmeActors.hasCap(a.id,d[n]);t.toggleClass("ws_preview_has_access",i)}):i.find("tr").removeClass("ws_preview_has_access"))}return i.on("mouseenter","td.ws_ame_suggested_capability",function(){var t=e(this).closest("tr");d(Q,t.data("capability"))}),G.on("keydown keyup",function(){d(Q,G.val())}),i.on("mousedown","td.ws_ame_suggested_capability",function(){J=!0}),i.on("click","td.ws_ame_suggested_capability",function(){var t=e(this).closest("tr").data("capability");W&&W.val(t).change(),$()}),e(document).on("click",function(t){J&&a.is(":visible")&&e(t.target).closest(a).length<1&&$()}),{previewAccessForItem:d,show:function(){a.css({position:"absolute",zIndex:1009}).show().position({my:"left top",at:"right top",of:G,collision:"none"});var e=G.height(),t=a.height(),i=Math.max(e,t);e<i&&G.height(i),t<i&&a.height(i),Q&&d(Q)},hide:function(){a.hide()}}}(),ee=e("#ws_icon_selector"),te=null,ae=ee.find("#ws_icon_source_tabs");ae.tabs(),ee.on("click",".ws_icon_option",function(){var t=e(this).addClass("ws_selected_icon");if(ee.hide(),te){var a=te.closest(".ws_container"),i=a.data("menu_item"),n=b(i,"css_class","");n=d(n.replace(/\b(ame-)?menu-icon-[^\s]+\b/,"")),t.data("icon-class")?(n=t.data("icon-class")+" "+n,
i.icon_url=""):t.data("icon-url")&&(i.icon_url=t.data("icon-url")),i.css_class=n,g(a)}te=null}),f.on("click",".ws_select_icon",function(){var t=e(this);if(te&&t.is(te))return ee.hide(),void(te=null);var a=(te=t).closest(".ws_container"),i=a.data("menu_item"),n=b(i,"css_class",""),s=b(i,"icon_url","",a),o=ee.find(".ws_custom_image_icon").hide();ee.find(".ws_selected_icon").removeClass("ws_selected_icon");var r=null,l=n.match(/\b(ame-)?menu-icon-([^\s]+)\b/),d=s&&s.match("^s*((?:dashicons|ame-fa)-[a-z0-9-]+)s*$");if(s&&"none"!==s&&"div"!==s&&!d){var c=ee.find('.ws_icon_option img[src="'+s+'"]').first().closest(".ws_icon_option");c.length>0?r=c.addClass("ws_selected_icon").show():(o.find("img").prop("src",s),o.addClass("ws_selected_icon").show().data("icon-url",s),r=o)}else if(l||d){var u=d?d[1]:(l[1]?l[1]:"")+"icon-"+l[2];r=ee.find("."+u).closest(".ws_icon_option").addClass("ws_selected_icon")}var _=null!==r?r.closest(".ws_tool_tab").prop("id"):"ws_core_icons_tab",p=ae.find('a[href="#'+_+'"]').closest("li");p.length>0&&ae.tabs("option","active",p.index()),ee.show(),ee.position({my:"left top",at:"left bottom",of:t})});var ie=null;e("#ws_choose_icon_from_media").click(function(e){e.preventDefault(),wsEditorData.isDemoMode?alert("Sorry, image upload is disabled in demo mode!"):null===ie?((ie=wp.media.frames.customAdminMenuIcon=wp.media({title:"Choose a Custom Icon (20x20)",library:{type:"image"},button:{text:"Set as icon",close:!0}})).on("select",function(){var e=ie.state().get("selection").first();if(te){var t=te.closest(".ws_container"),a=t.data("menu_item"),i=b(a,"css_class","");a.css_class=d(i.replace(/\b(ame-)?menu-icon-[^\s]+\b/,"")),a.icon_url=e.attributes.url,g(t)}te=null}),ie.on("escape",function(){te=null}),ie.open(),ee.hide()):ie.open()}),e(document).on("mouseup",function(t){ee.is(":visible")&&(ee.is(t.target)||0!==ee.has(t.target).length||0!==e(t.target).closest(".ws_select_icon").length||(ee.hide(),te=null))});var ne=e("#ws_embedded_page_selector"),se=ne.find("#ws_current_site_pages"),oe=null,re=!1,le=!1;function de(){var e,t=0,a=1;if(oe&&(e=oe.closest(".ws_container").data("menu_item"),t=parseInt(b(e,"embedded_page_id",0),10),a=parseInt(b(e,"embedded_page_blog_id",1),10)),0===t)se.val(null);else{var i=a+"_"+t;se.val(i),se.val()!==i&&se.val("custom")}ne.find("#ws_embedded_page_id").val(t),ne.find("#ws_embedded_page_blog_id").val(a)}function ce(e,t,a){if(oe){var i=oe.closest(".ws_container"),n=i.data("menu_item");n.embedded_page_id=e,n.embedded_page_blog_id=t,"string"==typeof a&&AmePageTitles.add(e,t,a),g(i)}}ne.tabs({heightStyle:"auto",hide:!1,show:!1}),ne.hide().appendTo(f),f.on("click",".ws_embedded_page_selector_trigger",function(t){var a=e(this),i=a.closest(".ws_edit_field").find("input.ws_field_value:first");if(a.is(oe)&&ne.is(":visible"))return ne.hide(),void(oe=null);if(oe=a,ne.show(),ne.position({my:"left top",at:"left bottom",of:i}),t.stopPropagation(),!re&&!le){le=!0;var n=ne.find("#ws_current_site_pages");n.prop("readonly",!0),e.getJSON(wsEditorData.adminAjaxUrl,{action:"ws_ame_get_pages",_ajax_nonce:wsEditorData.getPagesNonce},function(t){if(le=!1,n.prop("readonly",!1),void 0===t.error)if("object"==typeof t&&void 0!==t.length){var a=t.sort(function(e,t){return e.post_title.localeCompare(t.post_title)});n.empty(),e.each(a,function(t,a){n.append(e("<option>",{val:a.blog_id+"_"+a.post_id,text:a.post_title}))}),n.prepend(e("<option>",{val:"custom",text:"< Custom >"})),de(),re=!0}else alert("Error: Could not retrieve a list of pages. Unexpected response from the server.");else alert(t.error)},"json")}de(),ne.tabs("option","active","custom"===se.val()?1:0)}),e(document).on("mouseup",function(t){if(ne.is(":visible")){var a=e(t.target),i=0===a.closest(ne).length,n=oe&&0===a.closest(oe).length;i&&n&&(ne.hide(),oe=null)}}),se.on("change",function(){var e=se.val();if("custom"===e);else if(oe){var t=e.split("_"),a=parseInt(t[0],10),i=parseInt(t[1],10);ne.hide(),ce(i,a,se.children(":selected").text())}}),ne.find("#ws_custom_embedded_page_tab form").on("submit",function(e){e.preventDefault();var t=parseInt(ne.find("#ws_embedded_page_id").val(),10),a=parseInt(ne.find("#ws_embedded_page_blog_id").val(),10);isNaN(t)||t<0?alert("Error: Invalid post ID"):isNaN(a)||a<0?alert("Error: Invalid blog ID"):oe&&(ne.hide(),ce(t,a))});var ue=e("#ws-ame-menu-color-settings");ue.length>0&&ue.dialog({autoOpen:!1,closeText:" ",draggable:!1,modal:!0,minHeight:400,minWidth:520});var _e={menuItem:null,editingGlobalColors:!1},pe=["base-color","text-color","highlight-color","icon-color","menu-highlight-text","menu-highlight-icon","menu-highlight-background","menu-current-text","menu-current-icon","menu-current-background","menu-submenu-text","menu-submenu-background","menu-submenu-focus-text","menu-submenu-current-text","menu-bubble-text","menu-bubble-background","menu-bubble-current-text","menu-bubble-current-background"],me=e("#ame-menu-color-presets"),fe=e("#ws-ame-delete-color-preset"),we=!1,he=!1;e("#ws-ame-show-advanced-colors").click(function(){he=!he,e("#ws-ame-menu-color-settings").find(".ame-advanced-menu-color").toggle(he),e(this).text(he?"Hide advanced options":"Show advanced options")});var ve=!1;function ge(e){ve||(ue.find(".ame-color-picker").wpColorPicker({change:Ae,clear:Ae}),ve=!0),me.val(""),U||(xe(),U=!0),ue.dialog("option","title",e)}function be(){for(var t={},a=0,i=0;i<pe.length;i++){var n=pe[i],s=e("#ame-color-"+n).val();s&&(t[n]=s,a++)}return a>0?t:null}function ye(t){we=!0;for(var a=0,i=0;i<pe.length;i++){var n=pe[i],s=!!t.hasOwnProperty(n)&&t[n];s?(e("#ame-color-"+n).wpColorPicker("color",s),a++):e("#ame-color-"+n).closest(".wp-picker-container").find(".wp-picker-clear").click()}return we=!1,a}function xe(){var t=me.find("#ame-color-preset-separator");me.find("option").not(".ame-meta-option").remove();var a=e.map(N,function(e,t){return t}).sort(function(e,t){return e.localeCompare(t)}),i=jQuery([]);e.each(a,function(t,a){"[global]"!==a&&(i=i.add(e("<option>",{val:a,text:a})))}),i.insertBefore(t)}function Ae(){we||""===me.val()||me.val("")}function Ee(){return e("#ws_menu_box").find(".ws_active")}f.on("click",".ws_open_color_editor, .ws_color_scheme_display",function(){var a=e(this).parents(".ws_container").first(),i=a.data("menu_item");_e.containerNode=a,_e.menuItem=i,_e.editingGlobalColors=!1;var n=b(i,"menu_title",null);ge(n?"Colors: "+u(n):"Colors");var s=N.hasOwnProperty("[global]");ue.find("#ame-global-colors-preset").toggle(s);var o=b(i,"colors",{}),r=o||{};t.isEmpty(o)&&(i.colors=null,s&&(r=N["[global]"],me.val("[global]"),fe.hide())),ye(r),ue.dialog("open")}),e("#ws_edit_global_colors").click(function(){_e.editingGlobalColors=!0,_e.menuItem=null,_e.containerNode=null,ge("Default menu colors"),ye(t.get(N,"[global]",{})),ue.find("#ame-global-colors-preset").hide(),ue.dialog("open")}),e("#ws-ame-save-menu-colors").click(function(){ue.dialog("close");var e=be();if(_e.editingGlobalColors)null===e?delete N["[global]"]:N["[global]"]=e;else if(_e.menuItem){var a=_e.menuItem;t.has(N,"[global]")&&t.isEqual(e,N["[global]"])?a.colors=null:a.colors=e,g(_e.containerNode)}_e.containerNode=null,_e.menuItem=null,_e.editingGlobalColors=!1}),e("#ws-ame-apply-colors-to-all").click(function(){if(confirm("Apply these color settings to ALL top level menus?")){var t=be();null===t?delete N["[global]"]:N["[global]"]=t,e("#ws_menu_box").find(".ws_menu").each(function(){var t=e(this),a=t.data("menu_item");a.separator||(a.colors=null,g(t))}),ue.dialog("close"),_e.containerNode=null,_e.menuItem=null}}),me.change(function(){var a=e(this),i=a.val();if(fe.toggleClass("hidden",t.includes(["[save_preset]","[global]","",null],i)),"[save_preset]"===i&&ue.dialog("isOpen")){var n=be();if(null===n)return a.val(""),void alert("Error: No colors selected");var s=window.prompt("New preset name:","");if(null===s||""===d(s))return void a.val("");!function(e,t){N[e]=t,xe(),me.val(e),fe.removeClass("hidden")}(s,n)}else if(""!==i){ye(N[i])}}),fe.click(function(){var a=e("#ame-menu-color-presets").val();return!t.includes(["[save_preset]","[global]","",null],a)&&(!!confirm('Are you sure you want to delete the preset "'+a+'"?')&&(delete N[a],xe(),me.val(""),fe.addClass("hidden"),!1))}),e("#ws_hide_menu").click(function(e){e.preventDefault();var t=Ee();t.length&&M(t)}),f.find(".ws_toolbar").on("click",".ws_hide_and_deny_button",function(){var i=e(this).closest(".ws_main_container").find(".ws_box").is("#ws_menu_box")?Ee():Ne();if(!(i.length<1))if(null===a.selectedActor){var n,s=i.data("menu_item"),o=t.keys(wsEditorData.actors),r=t.intersection(["special:super_admin","user:"+wsEditorData.currentUserLogin],o),l=t.difference(o,r);n=t.some(l,t.curry(P,2)(s));var d=u(r,!0),c=t.assign(u(l,!1),d);!function t(a,i){w(a).each(function(){t(e(this),i)}),i(a,a.data("menu_item"))}(i,function(e,a){var i;if(n){i=c;var s=t.filter(l,function(e){return P(a,e)});(s.length>0||t.isEmpty(t.get(a,"had_access_before_hiding",null)))&&(a.had_access_before_hiding=s)}else{var r=t.get(a,"had_access_before_hiding",[])||[];r=t.intersection(r,o),i=t.assign(u(r,!0),d),delete a.had_access_before_hiding}T(e,i),g(e)})}else i.find("input.ws_actor_access_checkbox").click();function u(e,a){var i={};return t.forEach(e,function(e){i[e]=a}),i}});var De=e("#ws-ame-menu-deletion-error").dialog({autoOpen:!1,modal:!0,closeText:" ",title:"Error",draggable:!1}),ke=function(i){De.dialog("close");var n=De.data("selected_menu");function s(t,a){a(t.data("menu_item"));var i=t.data("submenu_id");i&&t.hasClass("ws_menu")&&e(".ws_item","#"+i).each(function(){var t=e(this);a(t.data("menu_item")),g(t)}),g(t)}function o(e,i){var n=t(a.getVisibleActors()).pluck("id").without(i).value();s(e,function(e){var a=t.filter(n,function(t){return P(e,t)});a.length>0&&(e.had_access_before_hiding=a),S(e,i)}),v(e)}if("all"===i)wsEditorData.wsMenuEditorPro?o(n,null):s(n,function(e){e.hidden=!0});else if("except_current_user"===i)o(n,"user:"+wsEditorData.currentUserLogin);else if("except_administrator"===i&&!wsEditorData.wsMenuEditorPro){s(n,function(e){e.extra_capability="manage_options"}),alert('The "required capability" field was set to "manage_options".')}};function Ce(t){if(!t||t.length<1)return!1;var a=t.data("menu_item"),i=""!==a.template_id&&a.template_id!==wsEditorData.unclickableTemplateId&&a.template_id!==wsEditorData.embeddedPageTemplateId&&!a.separator,n=!1;return i&&e("#ws_menu_editor").find(".ws_container").each(function(){var t=e(this).data("menu_item");return a===t||a.template_id!==t.template_id||(n=!0,!1)}),!i||n}function Ie(t){var a=t.data("menu_item"),i=!1;if(Ce(t)?i=confirm("Delete this menu?"):(De.find("#ws-ame-menu-type-desc").text(y(a,"is_plugin_page")?"an item added by another plugin":"a built-in menu item"),De.data("selected_menu",t),e("#ws_hide_menu_except_current_user").toggleClass("hidden",!wsEditorData.wsMenuEditorPro),e("#ws_hide_menu_except_administrator").toggleClass("hidden",wsEditorData.wsMenuEditorPro),De.dialog("open"),De.find("#ws_cancel_menu_deletion").focus()),i){var n=t.data("submenu_id");n&&e("#"+n).remove();var s=t.closest(".ws_submenu");t.remove(),s&&v(s)}}function Me(e,t){return e.separator&&(e.defaults.file=s("separator_")),""==b(e,"css_class","")&&(e.css_class="menu-top"),""==b(e,"icon_url","")&&(e.icon_url="dashicons-admin-generic"),""==b(e,"hookname","")&&(e.hookname=s()),t?r(e,t):r(e)}e("#ws_cancel_menu_deletion").click(function(){ke(!1)}),e("#ws_hide_menu_from_everyone").click(function(){ke("all")}),e("#ws_hide_menu_except_current_user").click(function(){ke("except_current_user")}),e("#ws_hide_menu_except_administrator").click(function(){ke("except_administrator")}),e("#ws_delete_menu").click(function(e){e.preventDefault();var t=Ee();t.length&&Ie(t)}),e("#ws_copy_menu").click(function(t){t.preventDefault();var a=e("#ws_menu_box").find(".ws_active");a.length&&(O=D(a))}),e("#ws_cut_menu").click(function(t){t.preventDefault();var a=e("#ws_menu_box").find(".ws_active");a.length&&(O=D(a),e("#"+a.data("submenu_id")).remove(),a.remove())}),e("#ws_paste_menu").click(function(t){if(t.preventDefault(),O){var a=e.extend(!0,{},O),i=e("#ws_menu_box").find(".ws_active");Me(a,i.length>0?i:null)}}),e("#ws_new_menu").click(function(t){t.preventDefault(),j++;var n=s(),o=e.extend(!0,{},wsEditorData.blankMenuItem,{custom:!0,template_id:"",menu_title:"Custom Menu "+j,file:n,items:[]});o.defaults=e.extend(!0,{},i.getDefaults("")),null!==a.selectedActor&&S(o,a.selectedActor);var l=e("#ws_menu_box").find(".ws_active");r(o,l.length>0?l:null).menu.find(".ws_edit_link").click()}),e("#ws_new_separator, #ws_new_submenu_separator").click(function(t){t.preventDefault(),j++;var a=s("separator_"),i=e.extend(!0,{},wsEditorData.blankMenuItem,{separator:!0,custom:!1,items:[],defaults:{separator:!0,css_class:"wp-menu-separator",access_level:"read",file:a,hookname:a}});if(-1===e(this).attr("id").indexOf("submenu")){var n=e("#ws_menu_box").find(".ws_active");r(i,n.length>0?n:null)}else Ue(i)}),e("#ws_toggle_all_menus").click(function(t){if(t.preventDefault(),null!==a.selectedActor){var i=e(".ws_menu","#ws_menu_box"),n=!P(i.eq(0).data("menu_item"),a.selectedActor);i.each(function(){z(e(this),a.selectedActor,n)})}else alert("This button enables/disables all menus for the selected role. To use it, click a role and then click this button again.")});var Pe=e("#ws-ame-copy-permissions-dialog").dialog({autoOpen:!1,modal:!0,closeText:" ",draggable:!1}),Te=e("#ame-copy-source-actor"),Se=e("#ame-copy-destination-actor");e("#ws_copy_role_permissions").click(function(t){t.preventDefault();var i=Te.val();Te.find("option").not("[disabled]").remove(),Se.find("option").not("[disabled]").remove(),e.each(a.getVisibleActors(),function(t,i){var n=e("<option>",{val:i.id,text:a.getNiceName(i)});Te.append(n),Se.append(n.clone())}),null!==a.selectedActor&&Se.val(a.selectedActor),i&&Te.val(i),Te.val()||Te.find("option").first().prop("selected",!0),Pe.dialog("open")});var Oe=e("#ws-ame-confirm-copy-permissions");function je(t,a,i){var n="desc"===a?-1:1,s=t.find(".ws_container"),o=s.first(),r="";s.each(function(){var t,a=e(this);a.is(".ws_menu_separator")?t=r:(t=d(a.find(".ws_item_title").text()),r=t),a.data("ame-sort-value",t)}),s.sort(function(t,a){var i=e(t).data("ame-sort-value"),s=e(a).data("ame-sort-value");return(i=i.toLowerCase())>(s=s.toLowerCase())?n:i<s?-n:0}),i&&o.prependTo(t)}function Ne(){return e("#ws_submenu_box").find(".ws_submenu:visible .ws_active")}function Ue(t,a){var i=[];for(var n in t.items)t.items.hasOwnProperty(n)&&i.push(l(t.items[n],!1));t.items=[],i.unshift(l(t,!1));for(var s=(a=a||e("#ws_submenu_box").find(".ws_submenu:visible")).find(".ws_active"),o=0;o<i.length;o++)s.length>0?s.after(i[o]):a.append(i[o]),g(i[o]),i[o].show();v(a)}function Ve(t,a){e("#import_menu_form").resetForm(),e("#ws_import_panel").hide(),e("#ws_import_error_message").text(a),e("#ws_import_error_http_code").text(t.status),e("#ws_import_error_response").text(""!==t.responseText?t.responseText:"[Empty response]"),e("#ws_import_error").show()}Oe.click(function(){var t=Te.val(),i=Se.val();null!==t&&null!==i?(e(".ws_menu","#ws_menu_box").add(".ws_item",k).each(function(){var a=e(this),n=a.data("menu_item"),s=P(n,t);s!==P(n,i)&&T(a,i,s)}),a.selectedActor===i&&(a.setSelectedActor(null),a.setSelectedActor(i)),Pe.dialog("close")):alert("Select a source and a destination first.")}),Oe.prop("disabled",!0),Te.add(Se).click(function(){var e=Te.val(),t=Se.val(),a=null!==e&&null!==t&&e!==t;Oe.prop("disabled",!a)}),f.find(".ws_toolbar").on("click",".ws_sort_menus_button",function(t){t.preventDefault();var a=e(this).data("sort-direction")||"asc",i=e(this).closest(".ws_main_container").find(".ws_box").first();i.is("#ws_submenu_box")&&(i=i.find(".ws_submenu:visible").first()),i.length>0&&je(i,a),i.is("#ws_menu_box")&&e("#ws_submenu_box").find(".ws_submenu").each(function(){je(e(this),a,!0)})}),e("#ws_toggle_toolbar").click(function(){var t=f.find(".ws_second_toolbar_row").toggle().is(":visible");e.cookie("ame-show-second-toolbar",t?"1":"0",{expires:90})}),e("#ws_hide_item").click(function(e){e.preventDefault();var t=Ne();t.length&&M(t)}),e("#ws_delete_item").click(function(e){e.preventDefault();var t=Ne();t.length&&Ie(t)}),e("#ws_copy_item").click(function(e){e.preventDefault();var t=Ne();t.length&&(O=D(t))}),e("#ws_cut_item").click(function(e){e.preventDefault();var t=Ne();if(t.length){O=D(t);var a=t.parent();t.remove(),v(a)}}),e("#ws_paste_item").click(function(t){(t.preventDefault(),O)&&(O.separator&&!wsEditorData.wsMenuEditorPro||Ue(e.extend(!0,{},O)))}),e("#ws_new_item").click(function(t){if(t.preventDefault(),!(e(".ws_submenu:visible").length<1)){j++;var n=e.extend(!0,{},wsEditorData.blankMenuItem,{custom:!0,template_id:"",menu_title:"Custom Item "+j,file:s(),items:[]});n.defaults=e.extend(!0,{},i.getDefaults("")),null!==a.selectedActor&&S(n,a.selectedActor);var o=l(n),r=e("#ws_submenu_box").find(".ws_submenu:visible"),d=r.find(".ws_active");d.length>0?d.after(o):r.append(o),g(o),o.find(".ws_edit_link").click(),v(o)}}),e("#ws_save_menu").click(function(){try{var t=E()}catch(t){if(t.hasOwnProperty("code")&&"duplicate_top_level_url"===t.code){for(var i="Error: Duplicate menu URLs. The following top level menus have the same URL:\n\n",n=0;n<t.duplicates.length;n++){i+=n+1+". "+e(t.duplicates[n]).find(".ws_item_title").first().text()+"\n"}i+="\nPlease change the URLs to be unique or delete the duplicates.",alert(i)}else alert(t.message);return}if(wsEditorData.wsMenuEditorPro){var s=function t(a,i){var n=null;return e.each(a,function(e,a){return a.template_id===i?(n=a,!1):!(a.hasOwnProperty("items")&&a.items.length>0&&null!==(n=t(a.items,i)))}),n}(t.tree,"options-general.php>menu_editor");if(null===s);else if(!P(s,"user:"+wsEditorData.currentUserLogin))return void alert('Error: This configuration would make you unable to access the menu editor!\n\nPlease click either your role name or "Current user ('+wsEditorData.currentUserLogin+')" and enable the "Menu Editor Pro" menu item.')}var o=A(t);e("#ws_data").val(o),e("#ws_data_length").val(o.length),e("#ws_selected_actor").val(null===a.selectedActor?"":a.selectedActor);var r=Ee();if(r.length>0){e("#ws_selected_menu_url").val(AmeEditorApi.getItemDisplayUrl(r.data("menu_item"))),e("#ws_expand_selected_menu").val(r.find(".ws_editbox").is(":visible")?"1":"");var l=Ne();l.length>0&&(e("#ws_selected_submenu_url").val(AmeEditorApi.getItemDisplayUrl(l.data("menu_item"))),e("#ws_expand_selected_submenu").val(l.find(".ws_editbox").is(":visible")?"1":""))}e("#ws_main_form").submit()}),e("#ws_load_menu").click(function(){confirm("Are you sure you want to load the default WordPress menu?")&&o(defaultMenu)}),e("#ws_reset_menu").click(function(){confirm("Undo all changes made in the current editing session?")&&o(customMenu)}),a.onChange(function(t){e("#ws_load_menu, #ws_reset_menu").prop("disabled",null!==t)}),e("#ws_load_menu, #ws_reset_menu").prop("disabled",null!==a.selectedActor),e("#ws_toggle_editor_layout").click(function(){var t=f.toggleClass("ws_compact_layout").hasClass("ws_compact_layout");e.cookie("ame-compact-layout",t?"1":"0",{expires:90});var a=e(this);if(a.is("input")){a.val(a.val().replace("âœ“","")),t&&a.val("âœ“ "+a.val())}}),e("#export_dialog").dialog({autoOpen:!1,closeText:" ",modal:!0,minHeight:100}),e("#ws_export_menu").click(function(){var a=e(this);a.prop("disabled",!0),a.val("Exporting..."),e("#export_complete_notice, #download_menu_button").hide(),e("#export_progress_notice").show();var i=e("#export_dialog");i.dialog("open");try{var n=A()}catch(e){return i.dialog("close"),alert(e.message),a.val("Export"),void a.prop("disabled",!1)}e.post(wsEditorData.adminAjaxUrl,{data:n,action:"export_custom_menu",_ajax_nonce:wsEditorData.exportMenuNonce},function(n){a.val("Export"),a.prop("disabled",!1),void 0!==n.error&&(i.dialog("close"),alert(n.error)),t.has(n,"download_url")&&(e("#download_menu_button").attr("href",t.get(n,"download_url")).data("filesize",t.get(n,"filesize")),e("#export_progress_notice").hide(),e("#export_complete_notice, #download_menu_button").show())},"json")}),e("#ws_cancel_export").click(function(){e("#export_dialog").dialog("close")}),e("#download_menu_button").click(function(){e("#export_dialog").dialog("close")}),e("#import_dialog").dialog({autoOpen:!1,closeText:" ",modal:!0}),e("#ws_cancel_import").click(function(){e("#import_dialog").dialog("close")}),e("#ws_import_menu").click(function(){e("#import_progress_notice, #import_progress_notice2, #import_complete_notice, #ws_import_error").hide(),e("#ws_import_panel").show(),e("#import_menu_form").resetForm(),e("#ws_start_import").attr("disabled","disabled");var t=e("#import_dialog");t.find(".hide-when-uploading").show(),t.dialog("open")}),e("#import_file_selector").change(function(){e("#ws_start_import").prop("disabled",!e(this).val())}),e("#import_menu_form").ajaxForm({dataType:"json",beforeSubmit:function(t){for(var a=0;a<t.length;a++)if("menu"===t[a].name&&(void 0===t[a].value||!t[a].value))return alert("Select a file first!"),!1;return e("#import_dialog").find(".hide-when-uploading").hide(),e("#import_progress_notice").show(),e("#ws_start_import").attr("disabled","disabled"),!0},success:function(t,a,i){e("#import_progress_notice").hide();var n=e("#import_dialog");if(n.dialog("isOpen"))if(null!==t){if(void 0!==t.error&&(alert(t.error),e("#import_menu_form").resetForm(),n.find(".hide-when-uploading").show()),void 0!==t.tree&&t.tree){var s=e("#import_progress_notice2").show();o(t),s.hide(),e("#import_complete_notice").show(),setTimeout(function(){e("#import_dialog").dialog("close")},500)}}else Ve(i,"Invalid response from server. Please check your PHP error log.")},error:function(e,t,a){Ve(e,a)}}),wsEditorData.wsMenuEditorPro&&(e("#ws_top_menu_dropzone").droppable({hoverClass:"ws_dropzone_hover",activeClass:"ws_dropzone_active",accept:function(e){return e.hasClass("ws_item")},drop:function(t,a){var i=D(a.draggable),n=Me(i);if(null===b(i,"parent")){var s=b(i,"file");e(a.draggable).siblings(".ws_item").each(function(){var a=e(this),i=a.data("menu_item");b(i,"parent")===s&&(Ue(i,n.submenu),t.ctrlKey||a.remove())})}t.ctrlKey||a.draggable.remove()}}),k.closest(".ws_main_container").droppable({hoverClass:"ws_top_to_submenu_drop_hover",accept:function(t){var a=e("#ws_submenu_box").find(".ws_submenu:visible");return t.hasClass("ws_menu")&&a.attr("id")!==t.data("submenu_id")},drop:function(e,t){Ue(D(t.draggable)),e.ctrlKey||t.draggable.remove()}}));var Fe=e("#ws_ame_general_vis_box"),Le=e("#ws_ame_show_admin_menu"),qe=e("#ws_ame_show_toolbar");AmeEditorApi.actorCanSeeComponent=function(e,i){if(null===i)return t.some(a.getVisibleActors(),function(t){return AmeEditorApi.actorCanSeeComponent(e,t.id)});var n=t.get(V,[e,i],null);if(null!==n)return n;if(i===AmeSuperAdmin.permanentActorId)return t.get(V,[e,AmeSuperAdmin.permanentActorId],!0);var s=AmeActors.getActor(i);if(s instanceof AmeUser){var o=t.get(V,e,{});if(s.isSuperAdmin)return AmeEditorApi.actorCanSeeComponent(e,AmeSuperAdmin.permanentActorId);var r=null;if(t.forEach(s.roles,function(e){var a=t.get(o,"role:"+e,!0);r=null===r?a:r||a}),null!==r)return r}return!0},AmeEditorApi.refreshComponentVisibility=function(){if(!(Fe.length<1)){var e=a.selectedActor;Le.prop("checked",AmeEditorApi.actorCanSeeComponent("adminMenu",e)),qe.prop("checked",AmeEditorApi.actorCanSeeComponent("toolbar",e))}},AmeEditorApi.setComponentVisibility=function(e,i,n){null===i?t.forEach(a.getVisibleActors(),function(a){t.set(V,[e,a.id],n)}):t.set(V,[e,i],n)},Fe.length>0&&(Le.click(function(){AmeEditorApi.setComponentVisibility("adminMenu",a.selectedActor,e(this).is(":checked"))}),qe.click(function(){AmeEditorApi.setComponentVisibility("toolbar",a.selectedActor,e(this).is(":checked"))}),Fe.find(".handlediv").click(function(){Fe.toggleClass("closed"),e.cookie("ame_vis_box_open",Fe.hasClass("closed")?"0":"1",{expires:90})}),a.onChange(function(){AmeEditorApi.refreshComponentVisibility()})),e(".ws_tooltip_trigger").qtip({style:{classes:"qtip qtip-rounded ws_tooltip_node"},hide:{fixed:!0,delay:300}}),f.on("mouseenter click",".ws_edit_field .ws_field_tooltip_trigger",function(t){var a=e(this),i=a.closest(".ws_edit_field").data("field_name");if(null!==p[i].tooltip){var n="Invalid tooltip";"string"==typeof p[i].tooltip?n=p[i].tooltip:"function"==typeof p[i].tooltip&&(n=function(){var t=e(this).closest(".ws_container").data("menu_item");return p[i].tooltip(t)}),a.qtip({overwrite:!1,content:{text:n},show:{event:t.type,ready:!0},style:{classes:"qtip qtip-rounded ws_tooltip_node"},hide:{fixed:!0,delay:300},position:{my:"bottom center",at:"top center"}},t)}}),f.on("mouseenter click",".ws_ext_permissions_indicator",function(){e(this).qtip({overwrite:!1,content:{text:function(){var a=e(this).data("ext_permissions"),i='Additional permission settings are available. Click "Edit..." to change them.',n="";return a&&a.hasOwnProperty("title")&&(n=a.title,a.hasOwnProperty("type")&&(n=t.capitalize(t.startCase(a.type).toLowerCase())+": "+n),i="<strong>"+n+"</strong><br>"+i),i}},show:{ready:!0},style:{classes:"qtip qtip-rounded ws_tooltip_node"},hide:{fixed:!0,delay:300},position:{my:"bottom center",at:"top center"}})}),e(".ws_hint_close").click(function(){var t=e(this).parents(".ws_hint").first();t.hide(),wsEditorData.showHints[t.attr("id")]=!1,e.post(wsEditorData.adminAjaxUrl,{action:"ws_ame_hide_hint",hint:t.attr("id")})});var He=e("#ws_ame_how_to_box");He.find(".handlediv").click(function(){He.toggleClass("closed"),e.cookie("ame_how_to_box_open",He.hasClass("closed")?"0":"1",{expires:180})}),wsEditorData.wsMenuEditorPro&&(a.onChange(function(){var t=e("#ws_menu_editor");t.toggleClass("ws_is_actor_view",null!==a.selectedActor),t.find(".ws_container").each(function(){h(e(this))})}),wsEditorData.hasOwnProperty("selectedActor")&&wsEditorData.selectedActor?a.setSelectedActor(wsEditorData.selectedActor):a.setSelectedActor(null));var ze=e("#ws_ame_test_access_screen").dialog({autoOpen:!1,modal:!0,closeText:" ",title:"Test access",width:900}),Re=e("#ws_ame_test_menu_item"),Be=e("#ws_ame_test_relevant_actor"),Ge=e("#ws_ame_start_access_test"),We=e("#ws_ame_test_access_frame"),Qe=null,Ke=e("#ws_ame_test_progress"),Je=e("#ws_ame_test_progress_text");function Ye(){We.off("load",Ye),Ke.hide(),Ge.prop("disabled",!1)}function $e(t){if(t.originalEvent.source===We.get(0).contentWindow){var a=t.originalEvent.data||t.originalEvent.message;console.log("message received",a),e(window).off("message",$e)}else console&&console.warn&&console.warn("AME: Received a message from an unexpected source. Message ignored.")}e("#ws_test_access").click(function(){Qe=E();var i=Ee(),n=Ne(),s=null,o=null,r=null;i.length>0&&(s=i.data("menu_item"),r=b(s,"url")),n.length>0&&(o=n.data("menu_item"),r=b(o,"url")),Re.empty(),function a(i,n,s){t.each(i,function(t){if(!t.separator){var i=u(b(t,"menu_title","[Untitled menu]"));n&&(i=n+" -> "+i);var o=b(t,"url","[no-url]"),l=e("<option>",{val:o,text:i});l.data("menu_item",t),l.data("parent_file",s||""),l.prop("selected",o===r),Re.append(l),t.items&&a(t.items,i,b(t,"file",""))}})}(Qe.tree),Be.empty(),Be.append(e("<option>",{text:"Not selected",val:""})),t.each(a.getVisibleActors(),function(t){var i=e("<option>",{val:t.id,text:a.getNiceName(t)});Be.append(i)}),null!==a.selectedActor&&Be.val(a.selectedActor),ze.dialog("open")}),Ge.click(function(){Ge.prop("disabled",!0),Ke.show(),Je.text("Sending menu settings...");var t=Re.find("option:selected").first(),a=t.data("menu_item"),i=t.val();e.ajax(wsEditorData.adminAjaxUrl,{data:{action:"ws_ame_set_test_configuration",data:A(Qe),_ajax_nonce:wsEditorData.setTestConfigurationNonce},method:"post",dataType:"json",success:function(n){if(!n)return alert("Error: Could not parse the server response."),void Ge.prop("disabled",!1);if(n.error)return alert(n.error),void Ge.prop("disabled",!1);if(!n.success)return alert("Error: The request failed, but there is no error information available."),void Ge.prop("disabled",!1);var s=new URL(i,window.location.href);s.searchParams.append("ame-test-menu-access-as",e("#ws_ame_test_access_username").val()),s.searchParams.append("_wpnonce",wsEditorData.testAccessNonce),s.searchParams.append("ame-test-relevant-role",Be.val()),s.searchParams.append("ame-test-target-item",b(a,"file","")),s.searchParams.append("ame-test-target-parent",t.data("parent_file")),Je.text("Loading the test page...."),e("#ws_ame_test_frame_placeholder").hide(),e(window).on("message",$e),We.show().on("load",Ye).prop("src",s.href)},error:function(e,t){alert("HTTP Error: "+t),Ge.prop("disabled",!1)}})}),o(customMenu),wsEditorData.selectedMenu&&(AmeEditorApi.selectMenuItemByUrl("#ws_menu_box",wsEditorData.selectedMenu,"1"===t.get(wsEditorData,"expandSelectedMenu")),wsEditorData.selectedSubmenu&&AmeEditorApi.selectMenuItemByUrl("#ws_submenu_box",wsEditorData.selectedSubmenu,"1"===t.get(wsEditorData,"expandSelectedSubmenu"))),f.css("visibility","visible")}e(document).ready(L);var q=0,H=window.setInterval(function(){F||q>=30?window.clearInterval(H):(q++,e&&e.isReady&&(F=!0,L()))},1e3)}(jQuery,wsAmeLodash),jQuery(function(e){"use strict";var t=e("#ws-ame-screen-meta-contents"),a=t.find("#ws-hide-advanced-settings");a.prop("checked",wsEditorData.hideAdvancedSettings),e("#ws-hide-advanced-settings").click(function(){if(wsEditorData.hideAdvancedSettings=a.prop("checked"),e(this).is(a)){var t=e("#ws_menu_editor");wsEditorData.hideAdvancedSettings?(t.find("div.ws_advanced").hide(),t.find("a.ws_toggle_advanced_fields").text(wsEditorData.captionShowAdvanced).show()):(t.find("div.ws_advanced").show(),t.find("a.ws_toggle_advanced_fields").text(wsEditorData.captionHideAdvanced).hide())}e.post(wsEditorData.adminAjaxUrl,{action:"ws_ame_save_screen_options",hide_advanced_settings:wsEditorData.hideAdvancedSettings?1:0,show_extra_icons:wsEditorData.showExtraIcons?1:0,_ajax_nonce:wsEditorData.hideAdvancedSettingsNonce})});var i=e("#adv-settings");i.length>0&&i.empty().append(t.show())});